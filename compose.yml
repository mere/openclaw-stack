services:
  browser:
    image: lscr.io/linuxserver/webtop:ubuntu-xfce
    container_name: ${INSTANCE:-chloe}-browser
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - ${BROWSER_CONFIG_DIR:-/var/lib/openclaw/browser}:/config
      - ${BROWSER_CONFIG_DIR:-/var/lib/openclaw/browser}/custom-cont-init.d:/custom-cont-init.d
    ports:
      - "${NOVNC_HOST:-127.0.0.1}:${NOVNC_PORT:-6080}:3000"
    shm_size: "1gb"
    restart: unless-stopped
    networks:
      openclaw_net:
        ipv4_address: ${BROWSER_IPV4:-172.31.0.10}

  openclaw-gateway:
    image: ${OPENCLAW_IMAGE:-ghcr.io/openclaw/openclaw:main}
    container_name: ${INSTANCE:-chloe}-openclaw-gateway
    network_mode: host
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
      NPM_CONFIG_PREFIX: /home/node/.openclaw/npm-global
      PATH: /home/node/.openclaw/npm-global/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    volumes:
      - ${OPENCLAW_STATE_DIR:-/var/lib/openclaw/state}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-/var/lib/openclaw/workspace}:/home/node/.openclaw/workspace
      - /var/lib/openclaw/bridge:/var/lib/openclaw/bridge
    init: true
    restart: unless-stopped
    command: ["node","dist/index.js","gateway","--bind","loopback","--port","18789","--allow-unconfigured"]

  openclaw-guard:
    image: ${OPENCLAW_IMAGE:-ghcr.io/openclaw/openclaw:main}
    container_name: ${INSTANCE:-chloe}-openclaw-guard
    network_mode: host
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GUARD_GATEWAY_TOKEN}
      NPM_CONFIG_PREFIX: /home/node/.openclaw/npm-global
      PATH: /home/node/.openclaw/npm-global/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    volumes:
      - ${OPENCLAW_GUARD_STATE_DIR:-/var/lib/openclaw/guard-state}:/home/node/.openclaw
      - ${OPENCLAW_GUARD_WORKSPACE_DIR:-/var/lib/openclaw/guard-workspace}:/home/node/.openclaw/workspace
      - /var/lib/openclaw/bridge:/var/lib/openclaw/bridge
      - /root/openclaw-stack:/opt/openclaw-stack
      - /var/run/docker.sock:/var/run/docker.sock
    init: true
    restart: unless-stopped
    command: ["node","dist/index.js","gateway","--bind","loopback","--port","18790","--allow-unconfigured"]

networks:
  openclaw_net:
    name: ${INSTANCE:-chloe}-net
    driver: bridge
    ipam:
      config:
        - subnet: ${DOCKER_SUBNET:-172.31.0.0/24}
