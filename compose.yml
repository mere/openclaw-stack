services:
  browser:
    image: lscr.io/linuxserver/webtop:ubuntu-xfce
    container_name: ${INSTANCE:-chloe}-browser
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
    volumes:
      - ${BROWSER_CONFIG_DIR:-/var/lib/openclaw/browser}:/config
    ports:
      - "${NOVNC_HOST:-127.0.0.1}:${NOVNC_PORT:-6080}:3000"
    shm_size: "1gb"
    restart: unless-stopped

  openclaw-gateway:
    build:
      context: ./vendor/openclaw
      dockerfile: Dockerfile
    image: openclaw:local
    container_name: ${INSTANCE:-chloe}-openclaw-gateway
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN}
      NPM_CONFIG_PREFIX: /home/node/.openclaw/npm-global
      # Ensure npm global installs are writable for uid 1000
      PATH: /home/node/.openclaw/npm-global/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    volumes:
      - ${OPENCLAW_STATE_DIR:-/var/lib/openclaw/state}:/home/node/.openclaw
      - ${OPENCLAW_WORKSPACE_DIR:-/var/lib/openclaw/workspace}:/home/node/.openclaw/workspace
    ports:
      - "${GATEWAY_HOST:-127.0.0.1}:${GATEWAY_PORT:-18789}:18789"
    init: true
    restart: unless-stopped
    command: ["node","dist/index.js","gateway","--bind","lan","--port","18789"]
